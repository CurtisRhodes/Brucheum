
$.fn.codeview=function(options){var caller=$(this);var cv=new CodeView(caller,options);cv.init();return cv;};$.fn.codeview.getVersion=function(){var version="0.8";return version;};function CodeView(caller,options){var me=this;var orgContent=caller.html();var content=caller.html();var previewContent=null;var options=jQuery.extend({language:"javascript",fontSize:"16px",tabToSpace:4,feedColor:true,showLog:true},options);me.init=function(){log("before manipulate:\r\n"+content);if(content!=null){caller.addClass("code");caller.css("font-size",options.fontSize);filterCharacter();removeLeadingSpace();if(options.feedColor){feedColor();}}
log("after manipulate:\r\n"+content);};me.showHtmlEntity=function(){var str="";for(var i=30;i<70;i++){str+="&#38;&#35;"+i+";  =  &#"+i+"<br>";}
return str;};var filterCharacter=function(){content=content.replace(/&lt;/g,'&#60;');content=content.replace(/&gt;/g,'&#62;');content=content.replace(/&amp;/g,'&#38;');content=content.replace(/&quot;/g,'&#34;');content=content.replace(/</gm,'&#60;');content=content.replace(/>/gm,'&#62;');content=content.replace(/\"/gm,'&#34;');content=content.replace(/\'/gm,'&#39;');content=content.replace(/\r?\n/g,'<br>');content=content.replace(/ /g,'&nbsp;');if(options.tabToSpace!=null&&options.tabToSpace>=0){var tgtString="";for(var i=0;i<options.tabToSpace;i++){tgtString+=" ";}
content=content.replace(/\t/g,tgtString);}
caller.html(content);};var removeLeadingSpace=function(){var lines=content.split("<br>");var leadingSpace="";for(var i=0;i<lines.length;i++){if($.trim(lines[i])!=""){var pos=lines[i].search(/\S/g);leadingSpace=lines[i].substr(0,pos);break;}}
if(leadingSpace!=""){content="";for(var i=0;i<lines.length;i++){var l=lines[i];var pos=lines[i].search(/\S/g);var leadingStr=lines[i].substr(0,pos);var tailingStr=lines[i].slice(pos);leadingStr=leadingStr.replace(leadingSpace,"");var appendStr=leadingStr+tailingStr;if(i!=lines.length-1||(i==lines.length-1&&checkOnlyWhiteSpace(appendStr)==false)){if(i>0){content+="<br>";}
content+=appendStr;}}}
caller.html(content);};var checkOnlyWhiteSpace=function(str){var checkstr=str.replace(/&nbsp;/g,' ');if($.trim(checkstr)==""){return true;}
return false;};var feedColor=function(){content=content.replace(/(function&nbsp;)/g,wrapKeywordText("function&nbsp;"));content=content.replace(/(var&nbsp;)/g,wrapKeywordText("var&nbsp;"));content=content.replace(/(try&nbsp;)/g,wrapKeywordText("try&nbsp;"));content=content.replace(/(catch&nbsp;)/g,wrapKeywordText("catch&nbsp;"));content=content.replace(/(finally&nbsp;)/g,wrapKeywordText("finally&nbsp;"));content=content.replace(/(\(true)/g,"("+wrapKeywordText("true"));content=content.replace(/(true\))/g,wrapKeywordText("true")+")");content=content.replace(/(&nbsp;true&nbsp;)/g,wrapKeywordText("&nbsp;true&nbsp;"));content=content.replace(/(true;)/g,wrapKeywordText("true")+";");content=content.replace(/(\(false)/g,"("+wrapKeywordText("false"));content=content.replace(/(false\))/g,wrapKeywordText("false")+")");content=content.replace(/(&nbsp;false&nbsp;)/g,wrapKeywordText("&nbsp;false&nbsp;"));content=content.replace(/(false;)/g,wrapKeywordText("false")+";");content=content.replace(/(while&nbsp;)/g,wrapKeywordText("while&nbsp;"));content=content.replace(/(while\()/g,wrapKeywordText("while")+"(");content=content.replace(/if(&nbsp;)*/g,wrapKeywordText("if&nbsp;"));content=content.replace(/(if\()/g,wrapKeywordText("if")+"(");content=content.replace(/(return&nbsp;)/g,wrapKeywordText("return&nbsp;"));content=content.replace(/({)/g,wrapKeywordText("{"));content=content.replace(/(})/g,wrapKeywordText("}"));var lines=content.split("<br>");content="";for(var i=0;i<lines.length;i++){var l=lines[i];var pos=l.indexOf("//");var offsetPos=0;while(pos>0&&l.charAt(pos-1)==':'){var nextStr=l.substr(pos+2);offsetPos+=pos+2;pos=nextStr.indexOf("//");}
if(pos>=0){pos+=offsetPos;var remain=l.substr(pos);l=l.substr(0,pos)+"<code_comment>"+remain+"</code_comment>";}
content+=l+"<br>";}
content=content.replace(/\/\*/g,"<code_comment>/*");content=content.replace(/\*\//g,"*/</code_comment>");var start=content.indexOf("<code_comment>");var end=content.indexOf("</code_comment>");var partialContent=content;var prefixContent="";while(start>=0&&end>start){var commentText=partialContent.slice(start,end+"</code_comment>".length);commentText=restoreKeywordText(commentText);prefixContent+=partialContent.slice(0,start)+commentText;partialContent=partialContent.slice(end+"</code_comment>".length);var start=partialContent.indexOf("<code_comment>");var end=partialContent.indexOf("</code_comment>");}
content=prefixContent+partialContent;caller.html(content);};var wrapKeywordText=function(text){return"<code_keyword>"+text+"</code_keyword>";};var wrapStringText=function(text){return"<code_string>"+text+"</code_string>";};var restoreKeywordText=function(text){text=text.replace(/<code_keyword>/g,"");text=text.replace(/<\/code_keyword>/g,"");return text;};var log=function(msg){if(options!=null&&options.showLog&&this.console!=null){this.console.log(msg);}};}