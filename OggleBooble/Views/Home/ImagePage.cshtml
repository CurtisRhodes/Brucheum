<link href="~/Styles/ImagePage.css" rel="stylesheet" />
<link href="~/Styles/jquery-ui.css" rel="stylesheet" />

<div id="staticableContent">
    <div class="threeColumnArray">
        <div id="leftColumn"></div>
        <div id="middleColumn">
            <div id="divBreadCrumbs"></div>
            <div id="divStatusMessage"></div>
            <div id="xx" class="adminRow">
                <div class="floatRight clickable" onclick="staticify()">staticify</div>
                <div class="floatRight clickable" onclick="showAllChildren()">combine</div>
                <div class="floatRight clickable" onclick="showMetaTagDialog()">meta tags</div>
            </div>
            <img id="getImagesLoadingGif" class="loadingGif" src="~/Images/loader.gif" />
            <div id="imageContainer" class="flexWrapContainer"></div>
            <div id="fileCount" class="countContainer"></div>
            <div id="text55"></div>
        </div>
        <div id="rightColumn"></div>
    </div>

    <div id="customViewer" class="expandoImageViewer">
        <div id="expandoViewerBanner" class="floatingCrudBanner">
            <div id="prev" class="viewerImageNav" onclick="slide('prev')">PREV</div>
            <img id="imgComment" class="leftSideButton" title="comment" onclick="showCommentDialog()" src="Images/comment.png" />
            <span id="expandoBannerText"></span>
            <div onclick="$('#customViewer').hide(); viewerShowing = false;" class="farSide"><img class="closeButton" src="/Images/close.png" height="35" /></div>

            <div id="next" class="farSide" onclick="slide('next')">NEXT</div>
            <div class="farSide" onclick="blowupImage()"><img class="popout" src="Images/expand02.png" /></div>
            <div class="slideShowContainer">
                <div class="farSide" onclick="runSlideShow('faster')"><img id="fasterSlideshow" title="faster slideshow" class="popout" src="Images/slideshowFaster.png" /></div>
                <div class="farSide" onclick="runSlideShow('start')"><img id="showSlideshow" title="start slideshow" class="popout" src="Images/slideshow.png" /></div>
                <div class="farSide" onclick="runSlideShow('slower')"><img id="slowerSlideShow" title="slower slideshow" class="popout" src="Images/slideshowSlower.png" /></div>
            </div>
        </div>
        @*<img id="magnifyingGlass" class="magnifyingGlass" src="~/Images/Loupe.png" onclick="blowupImage()" /></div>*@
        <div class="expandoImageDiv">
            <div id="leftClickArea" onclick="slide('prev')" contextmenu="viewerContextMenu()" class="hiddeClickArea"></div>
            <div id="rightClickArea" onclick="slide('next')" contextmenu="viewerContextMenu()" class="hiddeClickArea" style="left:50%;"></div>
            <img id="viewerImage" class="expandoImage" />
            <div id="redBar" class="redBarIsLocalIndicator"></div>
        </div>
    </div>

    <div id="thumbImageContextMenu" class="ogContextMenu" onmouseleave="$(this).fadeOut();">
        <div id="ctxModelName">model name</div>
        <div id="ctxSeeMore">see more of her</div>
        <div>Comment</div>
        <div>Explode</div>
        <div class="adminLink">Copy Link</div>
        <div class="adminLink">Remove Link</div>
        <div class="adminLink">Archive</div>
        <div class="adminLink">Set as Folder Image</div>
        <div class="adminLink">Set as Category Image</div>
        <div>About</div>
    </div>

    <div>@Html.Partial("_ModelInfoDialog")</div>
    <div>@Html.Partial("_ImageCommentDialog")</div>
    <script>
        var service = '@ViewBag.Service';
        var folderId = '@ViewBag.Folder';
        var folderName = "";
        var currentUser = '@User.Identity.Name';
        var ipAddress = '@ViewBag.IpAddress';
        var isPornEditor = '@ViewBag.IsPornEditor';
        var page = 0;
        var rootFolder = "";
        var mySubDirs = new Array();
        var thumbImageHeight = 200;
        var currentContextImageId;
        var imageArrayIndex = 0;
        var exploderInterval;
        var viewerShowing = false;
        var slideShow;
        var slideShowSpeed = 0;
    </script>
</div>

<div>@Html.Partial("_MoveImageDialog")</div>
<div>@Html.Partial("_CategoryDialog")</div>
<div>@Html.Partial("_MetaTagDialog")</div>

<script>
    var imageArray = new Array();
    $(document).ready(function () {
        if (folderId == "") {
            window.location.href = "/";
        }
        // set width
        $('#imageContainer').width($('#middleColumn').width());
        $('#imageContainer').css("max-height", $('#middleColumn').height() - 150);

        getBreadCrumbs();
        getImageLinks();

        if ((isPornEditor == "True") || (document.domain === 'localhost')) {
            $('.adminLink').show();
        }
        else {
            $('.adminLink').hide();
        }
    });

    function showMetaTagDialog() {
        openMetaTagDialog(folderId)
    }

    function XXshowStatic() {
        var pageName = $('#expandoBannerText').html() + ".html";

        $.ajax({
            type: "GET",
            url: "GetStaticPage&fileName=" + pageName,
            data: JSON.stringify(data),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (success) {
                if (success !== "") {


                    alert("CreateStaticFile returned: " + success);
                }
                else
                    alert("/api//File returned: " + success);
            },
            error: function (jqXHR, exception) {
                alert("CreateStaticFile error: " + getXHRErrorDetails(jqXHR, exception));
            }
        });

    }

    function getBreadCrumbs() {
        $.ajax({
            type: "GET",
            url: service + "api/DashBoard/GetBreadCrumbs?folderId=" + folderId,
            success: function (parents) {
                $('#headerMessage').html("");
                for (i = parents.length - 1; i >= 0; i--) {
                    $('#headerMessage').append("<a class='activeBreadCrumb' href='/Home/imagePage?folder=" + parents[i].FolderId + "'>" + parents[i].FolderName + "</a>");
                }
                $('.activeBreadCrumb').contextmenu(function () {
                    event.preventDefault();
                    window.event.returnValue = false;
                    showCategoryDialog(folderId);
                    //showBreadCrumbContextMenu($(this).attr("id"));
                });
                setLayout(parents[parents.length - 1].FolderName);
                document.title = parents[0].FolderName + " OggleBooble";
                folderName = parents[0].FolderName;
                $('#expandoBannerText').html(folderName);
            },
            error: function (jqXHR, exception) {
                $('#getImagesLoadingGif').hide();
                alert("getBreadCrumbs jqXHR : " + getXHRErrorDetails(jqXHR, exception));
            }
        });
    }

    function staticify() {
        var customHtml = $('#staticHeader').html();
        customHtml += $('#staticableContent').html();
        customHtml += $('#staticFooter').html();
        var data = new Object();
        data.Filename = $('#expandoBannerText').html() + ".html";
        data.html = customHtml;

        //data.ImageArray = JSON.parse(imageArray);
        //data.ImageArray = JSON.stringify(imageArray);
        //imageArray.push({
        //    Index: fileCount,
        //    Link: obj.FileName.replace(/ /g, "%20"),
        //    ImageId: obj.ImageId
        //});
        data.ImageArray = "[";
        for (i = 0; i < imageArray.length; i++) {
            data.ImageArray += "{ Link:'" + imageArray[i].Link + "', ImageId:'" + imageArray[i].ImageId + "'}";
            if (i < imageArray.length - 1)
                data.ImageArray += ",";
        }
        data.ImageArray += "]";

        //alert("data.ImageArray: " + data.ImageArray);

        $.ajax({
            type: "POST",
            url: "CreateImagePageStaticFile",
            data: JSON.stringify(data),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (success) {
                if (success === "ok") {
                    alert("CreateStaticFile returned: " + success);
                    //$('#lnkPermalink').show();
                    //$('#lnkStaticify').hide();
                }
                else
                    alert("/api//File returned: " + success);
            },
            error: function (jqXHR, exception) {
                alert("CreateStaticFile error: " + getXHRErrorDetails(jqXHR, exception));
            }
        });
    };

</script>
<script src="~/Scripts/ImagePage.js"></script>
