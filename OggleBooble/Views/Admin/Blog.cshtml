@{
    ViewBag.Title = "Blog";
}

<style>
    .crudList {
        float: left;
        border: solid 3px #555;
        height: 700px;
        width: 300px;
    }

    .blogCrudContainer {
        display: inline-block;
        border: solid 3px gold;
        margin-left: 122px;
    }

    .blogCrudArea {
        display: flex;
    }

    .crudLabel {
        min-width: 45px;
        margin-right: 4px;
        margin-left: 7px;
    }

    .roundedInput {
        margin-bottom: 7px;
        width: 500px;
    }

    /*.blogEntryTextArea {
        height: 500px;
        width: 800px;
        padding: 4px;
        font-size: 15px;
        margin: 7px;
    }*/

    .leftImage {
        border: solid .05px #555;
        height: 130px;
        min-width: 120px;
        margin-left: 10px;
    }

    .crudListItem {
        border: solid .05px rgba(154, 122, 122, 0.50);
        padding: 5px;
        margin: 5px;
        background-color: #f1ceb5;
        width: 285px;
        cursor: pointer;
    }

    .blogSelectList {
        height: 400px;
        overflow-y: auto;
    }

</style>

<div class="threeColumnArray">
    <div id="leftColumn">
        <div class="leftColumnList">
            <div onclick="window.location.blogSelectList='/Admin'">Admin</div>
            <div onclick="$('#oggleBlogEntry').fadeIn()">New Entry</div>
        </div>
    </div>
    <div id="middleColumn">
        <div id="divStatusMessage"></div>
        <div id="blogDisplayArea"></div>

        <div id="blogListDialog" title="blog entries">
            <div id="blogList" class="crudList blogSelectList"></div>
        </div>

    </div>
    <div id="rightColumn"></div>
</div>



@*<div id="oggleBlogEntry" class="floatingCrud">
    <div class="floatingCrudBanner">
        Blog Entry
        <div onclick="$('#oggleBlogEntry').fadeOut()" class="farSide">x</div>
    </div>
    <div class="floatingCrudContainer">
        <div><span>title</span><input id="txtBlogEntryTitle" class="roundedInput" /></div>
        <div><textarea id="txtBlogEntryComment" class="blogEntryTextArea"></textarea></div>
        <div class="roundendButton" onclick="saveBlogEntry()">Create</div>
    </div>
</div>*@



@*<div id="blogEditDialog" class="oggleHidden" title="Write a fantasy about this image">
    <div>
        <div class="crudRow">
            <div class="crudLabel inline">Title</div>
            <input id="txtCommentTitle" class="roundedInput" />
        </div>
        <div class="crudRow">
            <div class="crudLabel inline">Type</div>
            <select id="selCommentType" class="roundedInput" onchange="loadBlogList(); clearGets()">
                <option value="CMT">Image Comment</option>
                <option value="PGM">Programmer Notes</option>
                <option value="BLG">BlogEntry</option>
                <option value="CON">Site Content</option>
            </select>
        </div>
        <div class="crudRow">
            <div class="crudLabel inline">Link</div>
            <input id="txtLink" class="roundedInput" onblur="$('#imgBlogLink').attr('src', $('#txtLink').val());" />
        </div>
    </div>
    <div class="floatLeft">
        <img id="imgBlogLink" class="leftImage" />
    </div>
    <div class="crudRow">
        <div class="crudLabel">Comment</div>
        <div id="blogEditor" class="blogEntryTextArea"></div>
        <div>
            <div id="blogSave" class="roundendButton" onclick="saveBlogEntry()">Add</div>
            <div id="blogNew" class="roundendButton" onclick="newBlogEntry()">New</div>
            <div id="blogCancel" class="roundendButton" onclick="cancelBlogEntry()">Cancel</div>
        </div>

    </div>
*@



<script>
    var service = '@ViewBag.Service';
    var blogEntry = {};

    $(function () {

        /*.blogEntryTextArea {
        height: 500px;
        width: 800px;
        padding: 4px;
        font-size: 15px;
        margin: 7px;
        }*/
        $('#blogEditDialog').dialog({
            autoOpen: false,
            show: { effect: "fade" },
            hide: { effect: "blind" }
        });

        $('#blogListDialog').dialog({
            autoOpen: false,
            show: { effect: "fade" },
            hide: { effect: "blind" },
            top: "10",
            left: "700",
            height: "500",
            width: "800"
        });
        



        $('#blogEditor').summernote({
            height: 200,
            codemirror: { lineWrapping: true, mode: "htmlmixed", theme: "cobalt" },
            toolbar: [
                ['codeview'],
                ['font style', ['fontname', 'fontsize', 'color', 'bold', 'italic', 'underline']]
            ]
        });
    });


    $(document).ready(function () {

        $('#blogNew').hide();
        $('#imgBlogLink').attr("src", "http://boobs.ogglebooble.com/redballon.png");

        $('#blogListDialog').dialog("open");

        
        //$('#blogEditDialog').show();
        //$('#blogEditDialog').dialog("open");

        loadBlogList("CMT");

    });


    /// 11:19  May 24 20019
    ///  sometimes even I have to take a moment to figure out what I want to do.
    /// start with a display of blog entries
    //<option value="CMT">Comment</option>     image comment
    //<option value="WRN">Warning</option>     site content  // Let me extplain, porn warning,
    //<option value="BLG">BlogEntry</option>   opinions
    //<option value="BLG">BlogEntry</option>   opinions  philosphy of porn
    //<option value="GMT">MetaTag</option>     programmer notes

    function getBlogs() {
        try {
            $.ajax({
                type: "GET",
                url: service + "/api/OggleBlog/?id=" + id,
                success: function (model) {


                    //if (!model.CommentTitle.startsWith("ERROR")) {
                    //    blogEntry.Id = id;
                    //    $('#txtCommentTitle').val(model.CommentTitle);
                    //    $('#selCommentType').val(model.CommentType);
                    //    $('#txtLink').val(model.Link);
                    //    $('#txtComment').val(model.CommentText);
                    //    $('#blogSave').html("Edit")
                    //    $('#blogNew').hide();
                    //    $('#imgBlogLink').attr("src", model.Link);
                    //}
                    //else
                    //    alert("displayBlogEntry: " + success)
                },
                error: function (xhr) {
                    $('#getDirTreeLoadingGif').hide();
                    alert("displayBlogEntry xhr: " + xhr.statusText);
                }
            });
        } catch (e) {
            alert("displayBlogEntry catch: " + e);
        }
    }
    function getaBlogEntry()
    {
        try {
            $.ajax({
                type: "GET",
                url: service + "/api/OggleBlog/?id=" + id,
                success: function (model) {


                    //if (!model.CommentTitle.startsWith("ERROR")) {
                    //    blogEntry.Id = id;
                    //    $('#txtCommentTitle').val(model.CommentTitle);
                    //    $('#selCommentType').val(model.CommentType);
                    //    $('#txtLink').val(model.Link);
                    //    $('#txtComment').val(model.CommentText);
                    //    $('#blogSave').html("Edit")
                    //    $('#blogNew').hide();
                    //    $('#imgBlogLink').attr("src", model.Link);
                    //}
                    //else
                    //    alert("displayBlogEntry: " + success)
                },
                error: function (xhr) {
                    $('#getDirTreeLoadingGif').hide();
                    alert("displayBlogEntry xhr: " + xhr.statusText);
                }
            });
        } catch (e) {
            alert("displayBlogEntry catch: " + e);
        }
    }
    function loadBlogList(blogId) {
        try {
            $.ajax({
                type: "GET",
                url: service + "/api/OggleBlog?blogId=" + blogId,
                success: function (entries) {
                    $('#blogList').html("");
                    if (!entries[0].CommentTitle.startsWith("ERROR")) {
                        $.each(entries, function (idx, entry) {
                            if (entry.CommentType == $('#selCommentType').val()) {
                                $('#blogList').append("<div class='crudListItem' onclick=loadBlogEntry('" + entry.Id + "') >" + entry.CommentTitle + "</div>");
                            }
                        });
                    }
                    else
                        alert("loadBlogList: " + success)
                },
                error: function (xhr) {
                    $('#getDirTreeLoadingGif').hide();
                    alert("loadBlogList xhr: " + xhr.statusText);
                }
            });
        } catch (e) {
            alert("loadBlogList catch: " + e);
        }
    }
    function loadBlogEntry(id) {
        try {
            $.ajax({
                type: "GET",
                url: service + "/api/OggleBlog/?id=" + id,
                success: function (model) {
                    if (!model.CommentTitle.startsWith("ERROR")) {
                        blogEntry.Id = id;
                        $('#txtCommentTitle').val(model.CommentTitle);
                        $('#selCommentType').val(model.CommentType);
                        $('#txtLink').val(model.Link);
                        $('#txtComment').val(model.CommentText);
                        $('#blogSave').html("Edit")
                        $('#blogNew').hide();
                        $('#imgBlogLink').attr("src", model.Link);
                    }
                    else
                        alert("displayBlogEntry: " + success)
                },
                error: function (xhr) {
                    $('#getDirTreeLoadingGif').hide();
                    alert("displayBlogEntry xhr: " + xhr.statusText);
                }
            });
        } catch (e) {
            alert("displayBlogEntry catch: " + e);
        }
    }
    function newBlogEntry() {
        $('#blogSave').html("Add");
        $('#blogNew').hide();
        clearGets();
    }
    function clearGets() {
        $('#txtCommentTitle').val("");
        //$('#selCommentType').val("");
        $('#txtLink').val("");
        $('#txtComment').val("");
        $('#imgBlogLink').attr("src", "http://boobs.ogglebooble.com/redballon.png");
        blogEntry.Id = "";

    }
    function cancelBlogEntry() {
        $('#blogSave').html("Add");
        $('#blogNew').hide();
        clearGets();
    }
    function saveBlogEntry() {
        try {
            blogEntry.CommentTitle = $('#txtCommentTitle').val();
            blogEntry.CommentType = $('#selCommentType').val();
            blogEntry.Link = $('#txtLink').val();
            blogEntry.CommentText = $('#txtComment').val();
            //  UserId nvarchar(128),

            if ($('#blogSave').html() == "Add") {
                $.ajax({
                    type: "POST",
                    url: service + "/api/OggleBlog",
                    data: blogEntry,
                    success: function (success) {
                        if (success == "ok") {
                            displayStatusMessage("ok", "Entry Saved")
                            $('#blogSave').html("Edit")
                            $('#blogNew').show();s
                            loadBlogList();
                        }
                        else
                            alert("saveBlogEntry: " + success)
                    },
                    error: function (xhr) {
                        $('#getDirTreeLoadingGif').hide();
                        alert("saveBlogEntry xhr: " + xhr.statusText);
                    }
                });
            }
            else {
                $.ajax({
                    type: "PUT",
                    url: service + "/api/OggleBlog",
                    data: blogEntry,
                    success: function (success) {
                        if (success == "ok") {
                            displayStatusMessage("ok", "Entry Updated")
                            loadBlogList();
                        }
                        else
                            alert("saveBlogEntry: " + success)
                    },
                    error: function (xhr) {
                        $('#getDirTreeLoadingGif').hide();
                        alert("saveBlogEntry xhr: " + xhr.statusText);
                    }
                });
            }
        } catch (e) {
            alert("saveBlogEntry catch: " + e);
        }
    }

</script>

