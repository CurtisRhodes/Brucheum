<link href="~/Styles/jquery-ui.css" rel="stylesheet" />

<img id="moveCopyDialogLoadingGif" class="loadingGif" src="~/Images/loader.gif" />

<div id="moveCopyDialog" title="">
    <div>
        <div class="inline"><img id="copyDialogImage" class="copyDialogImage" /></div>
        <div id="dirTreeResults" class="pusedoTextBox"></div>
        <div class="inline"><img class="dirTreeDropdownButton" src="~/Images/caretDown.png" onclick="$('#dirTreeDropDown').show()" /></div>
    </div>
    <div id="dirTreeDropDown" class="hideableDropDown">
        @Html.Partial("_DirTree2");
    </div>
    <div id="btnCopyLink" class="roundendButton" onclick="copyLink(false)">Copy</div>
    <div id="btnMoveLink" class="roundendButton" onclick="copyLink(true)">Move</div>
    <div id="btnMoveImage" class="roundendButton" onclick="moveImage()">Move</div>
</div>

<style>
    .copyDialogImage {
        height: 100px;
        margin-right: 7px;
        display: inline;
    }
    .pusedoTextBox {
        display: inline-block;
        border: solid thin #000;
        min-width: 266px;
        padding-top: 4px;
        min-height: 30px;
    }
    .dirTreeDropdownButton {
        height: 40px;
        cursor: pointer;
        margin-left: 1px;
    }
    .hideableDropDown {
        display: inline-block;
        max-height: 600px;
        overflow-y: auto;
        display: none;
    }
</style>

<script>
    var moveCopyDialogLink = "";
    var copyLinkModel = {};
    var destinationPath = "";
    $(function () {
        $('#moveCopyDialog').dialog({
            autoOpen: false,
            show: { effect: "fade" },
            hide: { effect: "blind" },
            width: "520px"
        });
        $('#btnMoveLink').hide();
    });

    function showMoveCopyDialog(mode, link, folderId, imageSource) {
        moveCopyDialogLink = link;

        copyLinkModel.ImageId = link;
        moveCopyDialogFolderId = folderId;
        if (mode === "Copy") {
            $('#btnMoveImage').hide();
            $('#btnCopyLink').show();
            $('#moveCopyDialog').dialog('option', 'title', "Copy Image Link");
        }
        else {
            $('#btnMoveImage').show();
            $('#btnCopyLink').hide();
            $('#moveCopyDialog').dialog('option', 'title', "Move Image Link");
        }
        $('#copyDialogImage').attr("src", imageSource);
        $('#moveCopyDialog').dialog("open");
    }

    function moveImage() {
        $('#moveCopyDialogLoadingGif').show();
        var moveImageModel = new Object();
        moveImageModel.SourceFolderId = moveCopyDialogFolderId;
        moveImageModel.DestinationFolderId = copyLinkModel.CopyToFolderId;
        moveImageModel.GoDaddyLink = moveCopyDialogLink;
        $.ajax({
            type: "PUT",
            url: service + "/api/FtpImagePage/MoveImage",
            data: moveImageModel,
            success: function (success) {
                $('#moveCopyDialogLoadingGif').hide();
                if (success === "ok") {
                    displayStatusMessage("ok", "image moved to " + destinationPath);
                    $('#moveCopyDialog').dialog("close");
                }
                else
                    alert(success);
            },
            error: function (xhr) {
                $('#moveCopyDialogLoadingGif').hide();
                alert("moveImage xhr error: " + xhr.statusText);
            }
        });
    }

    function copyLink(andRemove) {
        $.ajax({
            type: "PUT",
            url: service + "/api/ImagePage",
            data: copyLinkModel,
            success: function (success) {
                if (success === "ok") {
                    displayStatusMessage("ok", "link coppyed to " + $('#dirTreeResults').html());
                    $('#moveCopyDialog').dialog("close");
                }
                else {
                    alert("copyLink: " + success);
                }
            },
            error: function (xhr) {
                alert("copyLink(andRemove) xhr error: " + xhr.statusText);
            }
        });
    }

    function toggleDirTree(id) {
        if ($('#' + id + '').css("display") === "none")
            $('#S' + id + '').html("[-] ");
        else
            $('#S' + id + '').html("[+] ");
        $('#' + id + '').toggle();
    }

    function onDirTreeClick(path, id) {
        if (id.startsWith("t2")) {
            copyLinkModel.CopyToFolderId = id.substring(2);
            destinationPath = path.replace(/%20/g, " ");
            $('#dirTreeResults').html(path.replace(/%20/g, " "));
            $('#dirTreeDropDown').hide();
        }
        else
            alert("onDirTreeClick id: " + id);
    }
</script>